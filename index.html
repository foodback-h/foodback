<!-- ... keep previous head and CSS ... -->

<!-- Add Hotel Modal -->
<div id="addHotelModal">
  <form id="addHotelForm" autocomplete="off">
    <button id="closeModal" type="button" title="Close">&times;</button>
    <h4>Add a New Hotel</h4>
    <input type="text" id="hotelName" placeholder="Hotel Name" required>
    <input type="text" id="hotelAddress" placeholder="Address" required>
    <select id="hotelCategory" required>
      <option value="">Category</option>
      <option value="luxury">Luxury</option>
      <option value="budget">Budget</option>
      <option value="family">Family-Friendly</option>
    </select>
    <select id="hotelDistrict" required>
      <option value="">District</option>
      <option>Ernakulam</option>
      <option>Thiruvananthapuram</option>
      <option>Alappuzha</option>
      <option>Idukki</option>
      <option>Kozhikode</option>
      <option>Wayanad</option>
    </select>
    <input type="number" id="hotelRating" step="0.1" min="1" max="5" placeholder="Rating (1-5)" required>
    <div style="margin:8px 0 16px 0;">
      <span id="locPickedMsg" style="color:#472dc2;font-weight:600;">Click the map to set hotel location</span>
    </div>
    <button type="submit" id="submitHotel" style="background:#472dc2;color:white;font-weight:600;font-size:1.07rem;border:none;padding:8px 18px;border-radius:7px;cursor:pointer;">Save Hotel</button>
  </form>
</div>

<!-- ... keep rest of page ... -->

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
  let hotels = [
    /* ... same sample hotels with existing data ... */
  ];
  var map = L.map('map').setView([10.1632, 76.6413], 7);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 18, attribution: '© OpenStreetMap'
  }).addTo(map);

  let markers = [];
  function showHotels(list) {
    markers.forEach(marker => map.removeLayer(marker));
    markers = [];
    const hotelListElem = document.getElementById("hotelList");
    hotelListElem.innerHTML = "";
    if(list.length === 0){
      hotelListElem.innerHTML='<div class="hotel-list-empty">No hotels match your filters or search. Try another term or reset filters!</div>';
      return;
    }
    list.forEach(hotel => {
      const marker = L.marker(hotel.coords).addTo(map)
        .bindPopup(`<b>${hotel.name}</b><br>${hotel.address}<br>District: ${hotel.district}<br>⭐ ${hotel.rating}`);
      markers.push(marker);
      hotelListElem.innerHTML += `
        <div class="hotel-item">
          <img src="${hotel.img || 'https://placehold.co/60x60?text=M'}" alt="hotel image" class="hotel-img"/>
          <div style="flex:1">
            <div class="hotel-title">${hotel.name}</div>
            <div class="hotel-details">
              <span>${hotel.category.replace(/^./, x => x.toUpperCase())}</span> | <span>${hotel.district}</span><br>
              Address: ${hotel.address}<br>
              Rating: <span class="hotel-rating">${hotel.rating} ⭐</span>
            </div>
          </div>
        </div>`;
    });
  }

  function filterAndSortHotels() {
    // ...same filtering/sorting logic...
  }

  document.getElementById('searchInput').addEventListener('input', filterAndSortHotels);
  document.getElementById('category').addEventListener('change', filterAndSortHotels);
  document.getElementById('district').addEventListener('change', filterAndSortHotels);
  document.getElementById('sortBy').addEventListener('change', filterAndSortHotels);

  // Add Hotel Modal with map picker
  let addHotelMarker = null;
  let pickedLatLng = null;
  document.getElementById('addHotelBtn').onclick = function () {
    document.getElementById('addHotelModal').style.display = 'flex';
    document.getElementById('locPickedMsg').innerText = "Click the map to set hotel location";
    pickedLatLng = null;
    if(addHotelMarker) {
      map.removeLayer(addHotelMarker);
      addHotelMarker = null;
    }
    map._container.style.pointerEvents = "auto";
  };

  document.getElementById('closeModal').onclick = function () {
    document.getElementById('addHotelModal').style.display = 'none';
    if(addHotelMarker) {
      map.removeLayer(addHotelMarker);
      addHotelMarker = null;
    }
    map._container.style.pointerEvents = "";
  };

  map.on('click', function(e) {
    if(document.getElementById('addHotelModal').style.display !== 'flex') return;
    pickedLatLng = e.latlng;
    document.getElementById('locPickedMsg').innerText = `Location picked ✔ (${pickedLatLng.lat.toFixed(4)}, ${pickedLatLng.lng.toFixed(4)})`;
    if(addHotelMarker) map.removeLayer(addHotelMarker);
    addHotelMarker = L.marker([pickedLatLng.lat, pickedLatLng.lng], {opacity:0.8}).addTo(map);
  });

  document.getElementById('addHotelForm').onsubmit = function(e) {
    e.preventDefault();
    if(!pickedLatLng) {
      document.getElementById('locPickedMsg').innerText = "Please click the map to set hotel location!";
      return;
    }
    const name = document.getElementById('hotelName').value;
    const address = document.getElementById('hotelAddress').value;
    const coords = [pickedLatLng.lat, pickedLatLng.lng];
    const category = document.getElementById('hotelCategory').value;
    const district = document.getElementById('hotelDistrict').value;
    const rating = parseFloat(document.getElementById('hotelRating').value);
    hotels.push({ name, address, coords, category, district, rating, img:'https://placehold.co/66x66?text=M' });
    document.getElementById('addHotelForm').reset();
    document.getElementById('addHotelModal').style.display = 'none';
    if(addHotelMarker) { map.removeLayer(addHotelMarker); addHotelMarker = null; }
    pickedLatLng = null;
    map._container.style.pointerEvents = "";
    filterAndSortHotels();
    map.setView(coords, 10); // Zoom to new hotel
  };

  showHotels(hotels);
</script>
